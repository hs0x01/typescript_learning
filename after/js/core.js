function observable(e){return ko.isObservable(e)?e:ko.observable(e)}function observableArray(e){if(!Array.isArray(e))throw new Error("An argument is not Array.");return ko.isObservable(e)?e:ko.observableArray(e)}var BaseModel=function(){function e(e){this._id=observable(e||"")}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),e}(),__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},DepartmentListModel=function(e){function t(t,n){e.call(this,t),this._departmentModelList=observableArray(n||[])}return __extends(t,e),Object.defineProperty(t.prototype,"departmentModelList",{get:function(){return this._departmentModelList},set:function(e){this._departmentModelList=e},enumerable:!0,configurable:!0}),t.prototype.findEmployeeByArgs=function(e,t,n){for(var o=[],i=this.departmentModelList(),r=0;r<i.length;r++)for(var l=i[r],d=l.employeeListModel(),a=d.employeeModelList(),s=0;s<a.length;s++){var p=a[s];e&&e!==p.id()||t&&p.name().indexOf(t)<0||n&&n!==p.departmentModel().id()||o.push(p)}return o},t.prototype.findDepartmentById=function(e){for(var t=this.departmentModelList(),n=0;n<t.length;n++){var o=t[n];if(e===o.id())return o}return null},t}(BaseModel),DepartmentModel=function(e){function t(t,n,o){e.call(this,t),this._name=observable(n||""),this._employeeListModel=observable(o||null)}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"employeeListModel",{get:function(){return this._employeeListModel},set:function(e){this._employeeListModel=e},enumerable:!0,configurable:!0}),t.prototype.addEmployee=function(e,t){var n=new EmployeeModel(e,t,this);this.employeeListModel().employeeModelList.push(n)},t.prototype.deleteEmployee=function(e){for(var t=this.employeeListModel().employeeModelList(),n=0;n<t.length;n++){var o=t[n];o.id()===e&&this.employeeListModel().employeeModelList.splice(n,1)}},t}(BaseModel),EmployeeListModel=function(e){function t(t,n){e.call(this,t),this._employeeModelList=observableArray(n||[])}return __extends(t,e),Object.defineProperty(t.prototype,"employeeModelList",{get:function(){return this._employeeModelList},set:function(e){this._employeeModelList=e},enumerable:!0,configurable:!0}),t}(BaseModel),EmployeeModel=function(e){function t(t,n,o){e.call(this,t),this._name=observable(n||""),this._departmentModel=observable(o||null)}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"departmentModel",{get:function(){return this._departmentModel},set:function(e){this._departmentModel=e},enumerable:!0,configurable:!0}),t.prototype.updateEmployeeInfo=function(e,t){if(this.name(e),this.departmentModel().id()!==t.id()){for(var n=this.departmentModel().employeeListModel().employeeModelList,o=0;o<n().length;o++){var i=n()[o];if(i.id()===this.id()){n().splice(o,1);break}}t.employeeListModel().employeeModelList.push(this),this.departmentModel(t)}},t}(BaseModel),DepartmentRepository=function(){function e(){}return e.findDepartmentAll=function(e){var t=null,n=localStorage.getItem(this.LOCAL_STORAGE_KEY);t=null===n?this.createDepartmentListModelFromDefault():this.createDepartmentListModelFromXml(n),e(t)},e.saveDepartmentAll=function(e,t){var n=this.createDepartmentListModelXml(e);localStorage.setItem(this.LOCAL_STORAGE_KEY,n),t()},e.createDepartmentListModelXml=function(e){var t='<?xml version="1.0" encoding="UTF-8"?>';t+="    <departmentListModel>",t+="        <id>"+e.id()+"</id>";for(var n=e.departmentModelList(),o=0;o<n.length;o++){var i=n[o];t+="    <departmentModel>",t+="        <id>"+i.id()+"</id>",t+="        <name>"+i.name()+"</name>",t+="        <employeeListModel>";var r=i.employeeListModel();t+="            <id>"+r.id()+"</id>";for(var l=r.employeeModelList(),d=0;d<l.length;d++){var a=l[d];t+="        <employeeModel>",t+="            <id>"+a.id()+"</id>",t+="            <name>"+a.name()+"</name>",t+="        </employeeModel>"}t+="        </employeeListModel>",t+="    </departmentModel>"}return t+="    </departmentListModel>"},e.createDepartmentListModelFromDefault=function(){var e=new EmployeeListModel(GuidUtil.createGuid(),[]),t=new EmployeeListModel(GuidUtil.createGuid(),[]),n=new EmployeeListModel(GuidUtil.createGuid(),[]),o=new DepartmentModel(GuidUtil.createGuid(),"開発部",e),i=new DepartmentModel(GuidUtil.createGuid(),"営業部",t),r=new DepartmentModel(GuidUtil.createGuid(),"総務部",n),l=[];l.push(o),l.push(i),l.push(r);var d=new DepartmentListModel(GuidUtil.createGuid(),l);return d},e.createDepartmentListModelFromXml=function(e){var t=$($.parseXML(e)),n=t.find("departmentListModel"),o=n.children("id").text(),i=new DepartmentListModel(o,[]),r=n.find("departmentModel");return r.each(function(){var e=$(this),t=e.children("id").text(),n=e.children("name").text(),o=e.find("employeeListModel"),r=o.children("id").text(),l=new DepartmentModel(t,n,new EmployeeListModel(r,[]));i.departmentModelList.push(l);var d=o.find("employeeModel");d.each(function(){var e=$(this),t=e.children("id").text(),n=e.children("name").text();l.addEmployee(t,n)})}),i},e.LOCAL_STORAGE_KEY="sample.all-department-model",e}(),GuidUtil=function(){function e(){}return e.createGuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e}();